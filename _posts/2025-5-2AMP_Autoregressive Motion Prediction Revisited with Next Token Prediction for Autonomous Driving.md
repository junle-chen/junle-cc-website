### 一、研究背景与动机
运动预测是自动驾驶系统的关键模块之一，任务是预测周围交通参与者（如车辆、行人等）在未来几秒内的位置。这有助于下游模块（如规划器）做出安全路径决策。

传统方法分为两类：


#### （1）自回归预测（Autoregressive Prediction）

- 思想：像人一样“边思考边行动”，模型逐步地预测每一个时间步：
    $$P(S_1,...,S_T|S_{obs})=\prod_{t=1}^TP(S_t|S_1,...,S_{t-1},S_{obs})$$
- 应用：早期方法如 Social-LSTM、MFP 就是基于这种方式，通常结合 RNN + CVAE 来逐步生成轨迹。
    
- 缺点：
    
    - 训练不稳定（尤其是带变分推断的CVAE架构）；
        
    - 误差容易在长序列中积累（Cumulative Error）；
        
    - 长期依赖关系捕捉困难。
        

#### （2）独立预测（Independent Prediction）

- 假设未来各时间步在已观察数据条件下彼此独立：
    
    $$P(S_1,...,S_T|S_{obs})=\prod_{t=1}^TP(S_t|S_{obs})$$
- 实现方式：使用简单的MLP，一次性预测所有时间步。
    
- 优势：
    
    - 训练高效，误差不累积；
        
    - 简单，效果反而更好（多数SOTA方法采用这种方式）；
        
    - 多次获得比赛冠军（如MTR、MTR++等）。
        
- 文章使用11帧，1.1秒历史轨迹（10Hz采样）作为输入，预测8秒，生成16帧轨迹（2Hz），说实话，我一开始有点震惊，但是融合了全局信息（地图以及其他车辆），这么看起来也是合理的
### 1.3 新问题与挑战

- 自回归模型为什么在NLP领域有效（如GPT）但在运动预测中不行？
    
- 原因之一是：NLP中输入与输出都是“词”，天然同质；而在运动预测中，观察状态与未来状态的表示不一致。
    
- 另一个问题是：运动预测场景非常**异构**（地图、车辆、行人有不同语义和时空关系），而不像语言序列是纯粹的一维序列。


### 二、AMP方法简介

![](assets/Pasted%20image%2020250502215225.png)



论文提出了**AMP（Autoregressive Motion Prediction）**，核心创新在于：

1. **统一表示空间**：借鉴GPT的思想，将观察状态和未来状态都编码为统一的“token”，在同一语义空间中建模。
    
2. **自回归生成机制**：采用“下一个token预测”方式生成轨迹，使得每个时间步的预测依赖于之前的内容，符合序列生成逻辑。
    
3. **三种注意力机制组合**：
    
#### （1）Context Cross-Attention（跨上下文注意力）

- 让目标车辆（focal token）关注周围环境（non-focal车辆 & 地图）。
    
- 使用相对空间编码（∆x, ∆y, ∆θ）+ 时间步差的编码（TPE）。
    

#### （2）Temporal Self-Attention（时间自注意力）

- 模拟 GPT 的“因果关系”：预测t步时只能看到t前的历史；
    
- 使用因果掩码（Causal Mask）避免泄露；
    
- 引入 **RoPE（Rotary Positional Encoding）** 来表示时间差。
    

#### （3）Spatial Self-Attention（空间自注意力）

- 建模同一时间步不同焦点车辆之间的交互；
    
- 只在训练和推理时都“已知”的时间段使用，避免多模态预测带来的不确定性。

### 三、数据预处理与Token化

#### 输入包含：

- **S_obs**：观察到的周围车辆轨迹（过去T秒）；
    
- **S_map**：静态地图（多段polyline）；
    
- **S_future**：目标预测的未来轨迹（仅训练时可见）。
    

#### 核心步骤：

- 所有输入被转换为 **统一表示空间（统一Token）**：
    
    - 地图元素 → **Map Token**
        
    - 非焦点车辆轨迹 → **Non-Focal Token**
        
    - 焦点车辆（需要预测的） → **Focal Token**
        
- 所有坐标转化为 **Ego-Centric坐标系**，使得不同类型元素可以进行统一建模。
    
- 使用 **PointNet** 对每段轨迹（或polyline）编码为一个Token，得到Token序列。

### 四、多模态解码器与预测过程

预测过程不仅输出单一结果，而是生成**多个可能的未来轨迹（multi-modal prediction）**，结合短期意图和长期目标。训练阶段采用“胜者全得”（winner-take-all）策略，只对最佳模式回传损失。
具体而言：
- 设计了一个 **Multi-Modal解码器**，可以输出多个可能的未来轨迹：
    
    - 先对每个Token引入多个“长期目标”向量（来自Tfuture的聚类中心）；
        
    - 再结合“短期目标”（Ttoken）进行局部意图建模；
        
    - 使用MLP生成具体的轨迹坐标序列。
        
- 采用短期+长期轨迹融合策略，提升精度与稳定性。

### 五、实验结果与分析

- **性能领先**：AMP在Waymo Open Motion和Waymo Interaction两个数据集上取得SOTA（最先进）成绩，超越了已有的自回归方法如MotionLM和StateTransformer。
    
- **与独立预测接近**：AMP显著缩小了自回归方法与独立预测方法（如MTR++）之间的性能差距。
    
- **消融实验验证**：针对位置编码、训练策略、融合函数等多个模块进行消融实验，验证设计的有效性。
